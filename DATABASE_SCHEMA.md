# AvenSuites - Documenta√ß√£o do Banco de Dados

## üìä Vis√£o Geral

O banco de dados **AvenSuites** foi projetado para suportar um sistema completo de gest√£o hoteleira, incluindo gest√£o de hot√©is, quartos, reservas, h√≥spedes, faturamento e comunica√ß√£o.

### Caracter√≠sticas Principais

- **Banco**: MySQL 8.0 com charset utf8mb4
- **Charset**: utf8mb4_0900_ai_ci
- **Criptografia**: PII (Dados Pessoais) com AES-GCM e deriva√ß√£o via Argon2id
- **Arquitetura**: Modular em microservi√ßos orientada a eventos
- **Padr√£o**: Nomes em snake_case compat√≠vel com EF Core

---

## üèóÔ∏è Estrutura do Banco

### **1. Gest√£o de Hot√©is e Usu√°rios**

#### **hotels**
Armazena informa√ß√µes dos hot√©is cadastrados no sistema.

```sql
hotels (
  hotel_id,           -- CHAR(36) PK
  name,              -- Nome do hotel
  trade_name,        -- Nome fantasia
  cnpj,             -- CNPJ √∫nico
  email, phone_e164,
  timezone,         -- Default: America/Sao_Paulo
  address_line1/2, city, state, postal_code,
  country_code,     -- Default: 'BR'
  status            -- ACTIVE/INACTIVE
)
```

#### **users**
Usu√°rios do sistema (funcion√°rios do hotel).

```sql
users (
  user_id,          -- CHAR(36) PK
  hotel_id,        -- FK ‚Üí hotels
  full_name, email,
  email_verified,
  password_hash,   -- VARBINARY(200) - Argon2
  status,
  created_at, updated_at
)
```

#### **roles** e **user_roles**
Sistema de autoriza√ß√£o por roles (Admin, User, Gestor, etc.)

```sql
roles (
  role_id,         -- CHAR(36) PK
  name, created_at
)

user_roles (
  user_id,         -- PK/FK ‚Üí users
  role_id          -- PK/FK ‚Üí roles
)
```

---

### **2. M√≥dulo de H√≥spedes**

#### **guests**
Tabela principal de h√≥spedes.

```sql
guests (
  guest_id,        -- CHAR(36) PK
  hotel_id,       -- FK ‚Üí hotels
  marketing_consent, -- BOOLEAN
  created_at, updated_at
)
```

#### **guest_pii**
**Dados Pessoais Identific√°veis (LGPD)** com criptografia AES-GCM.

```sql
guest_pii (
  guest_id,        -- CHAR(36) PK/FK ‚Üí guests
  
  -- Dados PII criptografados
  full_name, email, phone_e164,
  document_type, document_plain,
  birth_date,
  address_line1/2, city, state, postal_code,
  
  -- Hashes SHA256 para busca
  email_sha256,
  phone_sha256,
  document_sha256,
  
  -- Criptografia AES-GCM
  document_cipher,     -- VARBINARY(128)
  document_nonce,      -- VARBINARY(12)
  document_tag,        -- VARBINARY(16)
  document_key_version
)
```

**Seguran√ßa:**
- Dados sens√≠veis (CPF, RG) criptografados com AES-GCM
- Hashes SHA256 para pesquisa sem descriptografar
- Vers√£o de chave para rotacionamento

#### **hotel_keys**
Chaves de criptografia por hotel (Argon2id).

```sql
hotel_keys (
  hotel_id,       -- PK/FK ‚Üí hotels
  key_version,    -- PK (INT)
  kdf_salt,      -- VARBINARY(16)
  created_at, active
)
```

---

### **3. M√≥dulo de Quartos**

#### **room_types**
Tipos de quarto (Suite, Standard, Deluxe, etc.)

```sql
room_types (
  room_type_id,    -- CHAR(36) PK
  hotel_id,       -- FK ‚Üí hotels
  code,           -- VARCHAR(30) - √∫nico por hotel
  name, description,
  capacity_adults,    -- Default: 2
  capacity_children,  -- Default: 0
  base_price,
  active,
  created_at, updated_at
)
```

#### **amenities** e **room_type_amenities**
Amenidades (Wi-Fi, Ar Condicionado, etc.)

```sql
amenities (
  amenity_id, code, name
)

room_type_amenities (
  room_type_id,  -- PK/FK ‚Üí room_types
  amenity_id    -- PK/FK ‚Üí amenities
)
```

#### **rooms**
Quartos f√≠sicos do hotel.

```sql
rooms (
  room_id,        -- CHAR(36) PK
  hotel_id,      -- FK ‚Üí hotels
  room_type_id,  -- FK ‚Üí room_types
  room_number,   -- VARCHAR(20) - √∫nico por hotel
  floor,
  status,        -- ACTIVE/MAINTENANCE/OCCUPIED
  created_at, updated_at
)
```

#### **maintenance_blocks**
Bloqueios de manuten√ß√£o dos quartos.

```sql
maintenance_blocks (
  block_id,       -- CHAR(36) PK
  room_id,        -- FK ‚Üí rooms
  start_date, end_date,
  reason,
  status,         -- ACTIVE/COMPLETED
  created_by,
  created_at, updated_at
)
```

---

### **4. M√≥dulo de Planos de Tarifas**

#### **rate_plans**
Planos de tarifa (Flex√≠vel, N√£o Reembols√°vel, etc.)

```sql
rate_plans (
  rate_plan_id,   -- CHAR(36) PK
  hotel_id,      -- FK ‚Üí hotels
  room_type_id,  -- FK ‚Üí room_types
  name, currency, -- Default: 'BRL'
  meal_plan,     -- ROOM_ONLY/BREAKFAST/HALF_BOARD
  cancellation_policy,
  active,
  created_at, updated_at
)
```

#### **rate_plan_prices**
Pre√ßos por data (precifica√ß√£o din√¢mica).

```sql
rate_plan_prices (
  rpp_id,         -- CHAR(36) PK
  rate_plan_id,  -- FK ‚Üí rate_plans
  price_date,    -- DATE
  price_amount,
  min_stay,      -- Default: 1
  max_stay,
  created_at, updated_at
)
```

---

### **5. M√≥dulo de Reservas (Bookings)**

#### **bookings**
Reservas principais.

```sql
bookings (
  booking_id,     -- CHAR(36) PK
  hotel_id,      -- FK ‚Üí hotels
  code,          -- VARCHAR(20) - √∫nico por hotel (ex: "RES-2025-001")
  status,        -- PENDING/CONFIRMED/CANCELLED/CHECKED_IN/CHECKED_OUT
  source,        -- WEBSITE/WHATSAPP/PHONE/API
  check_in_date, -- DATE
  check_out_date,
  adults, children,
  currency, total_amount,
  main_guest_id, -- FK ‚Üí guests
  channel_ref,   -- Refer√™ncia externa
  notes,
  created_by,    -- FK ‚Üí users
  created_at, updated_at
)
```

#### **booking_guests**
H√≥spedes da reserva (principal + acompanhantes).

```sql
booking_guests (
  booking_id,     -- PK/FK ‚Üí bookings
  guest_id,      -- PK/FK ‚Üí guests
  role           -- MAIN_GUEST/COMPANION
)
```

#### **booking_rooms**
Quartos da reserva.

```sql
booking_rooms (
  booking_room_id, -- CHAR(36) PK
  booking_id,     -- FK ‚Üí bookings
  room_id,        -- FK ‚Üí rooms
  room_type_id,   -- FK ‚Üí room_types
  rate_plan_id,   -- FK ‚Üí rate_plans
  price_total,
  notes,
  created_at, updated_at
)
```

#### **booking_room_nights**
Desagrega√ß√£o da reserva por noite (para faturamento).

```sql
booking_room_nights (
  brn_id,         -- CHAR(36) PK
  booking_room_id,-- FK ‚Üí booking_rooms
  room_id,        -- FK ‚Üí rooms
  stay_date,      -- DATE
  price_amount,   -- Pre√ßo da noite
  tax_amount,
  created_at
)
```

#### **booking_payments**
Pagamentos da reserva.

```sql
booking_payments (
  payment_id,     -- CHAR(36) PK
  booking_id,    -- FK ‚Üí bookings
  method,        -- CREDIT_CARD/DEBIT/PIX
  status,         -- PENDING/PAID/FAILED
  amount, currency,
  transaction_id,
  paid_at,
  created_at, updated_at
)
```

#### **booking_status_history**
Auditoria de mudan√ßas de status.

```sql
booking_status_history (
  bsh_id,         -- CHAR(36) PK
  booking_id,     -- FK ‚Üí bookings
  old_status,
  new_status,
  changed_by,     -- FK ‚Üí users
  changed_at,
  notes
)
```

---

### **6. M√≥dulo de Faturamento (Invoices)**

#### **invoices**
Notas fiscais eletr√¥nicas (NF-e).

```sql
invoices (
  invoice_id,     -- CHAR(36) PK
  booking_id,     -- FK ‚Üí bookings (UNIQUE)
  hotel_id,      -- FK ‚Üí hotels
  status,        -- PENDING/PROCESSING/ISSUED/CANCELLED
  issue_date,
  nfse_number,   -- N√∫mero da NFSe
  nfse_series,
  rps_number,
  verification_code,
  erp_provider,
  erp_protocol,
  total_services,
  total_taxes,
  xml_s3_key,    -- Chave S3 do XML
  pdf_s3_key,   -- Chave S3 do PDF
  raw_response_json,
  created_at, updated_at
)
```

#### **invoice_items**
Itens da nota fiscal.

```sql
invoice_items (
  invoice_item_id, -- CHAR(36) PK
  invoice_id,     -- FK ‚Üí invoices
  description,
  quantity,
  unit_price,
  tax_code,       -- C√≥digo tribut√°rio
  tax_rate,
  total
)
```

#### **erp_integration_logs**
Log de integra√ß√£o com ERP fiscal.

```sql
erp_integration_logs (
  erp_log_id,     -- CHAR(36) PK
  booking_id,     -- FK ‚Üí bookings
  invoice_id,     -- FK ‚Üí invoices
  endpoint,
  success,
  error_message,
  request_json,
  response_json,
  created_at
)
```

---

### **7. M√≥dulo de Notifica√ß√µes**

#### **notification_templates**
Templates de e-mail/WhatsApp.

```sql
notification_templates (
  template_key,   -- VARCHAR(80) PK
  channel,        -- EMAIL/WHATSAPP/SMS
  subject_tpl, body_tpl,
  created_at
)
```

#### **notification_logs**
Hist√≥rico de envios.

```sql
notification_logs (
  notification_id,  -- CHAR(36) PK
  channel, template_key,
  to_address, to_whatsapp,
  subject, body,
  related_booking_id, related_invoice_id,
  provider_message_id,
  status,           -- QUEUED/SENT/FAILED
  error_message,
  sent_at, created_at
)
```

---

### **8. M√≥dulo de Chat (WhatsApp/Baileys)**

#### **chat_sessions**
Sess√µes de chat.

```sql
chat_sessions (
  session_id,     -- CHAR(36) PK
  hotel_id,      -- FK ‚Üí hotels
  guest_id,      -- FK ‚Üí guests
  wa_user_jid,   -- WhatsApp JID
  state_json,    -- Estado da sess√£o
  last_interaction_at,
  created_at, updated_at
)
```

#### **chat_messages**
Mensagens do chat.

```sql
chat_messages (
  chat_message_id, -- CHAR(36) PK
  session_id,     -- FK ‚Üí chat_sessions
  direction,      -- INBOUND/OUTBOUND
  message_id_ext, content_text,
  raw_payload,
  created_at
)
```

---

### **9. Eventos de Integra√ß√£o**

#### **integration_event_outbox**
Outbox Pattern para eventos (Polly).

```sql
integration_event_outbox (
  outbox_id,       -- CHAR(36) PK
  aggregate_type,  -- Booking/Invoice
  aggregate_id,
  event_type,      -- BookingCreated/InvoiceIssued
  payload_json,
  status,          -- PENDING/PUBLISHED
  attempts,
  last_error,
  created_at, published_at
)
```

#### **integration_event_inbox**
Idempot√™ncia de eventos consumidos.

```sql
integration_event_inbox (
  inbox_id,        -- CHAR(36) PK
  event_id_ext,
  event_type,
  consumed_at,
  payload_hash
)
```

---

### **10. Outras Tabelas**

#### **api_idempotency_keys**
Idempot√™ncia de requisi√ß√µes API.

```sql
api_idempotency_keys (
  idempotency_key, -- VARCHAR(80) PK
  scope, request_hash,
  response_code, response_body,
  created_at, expires_at
)
```

#### **audit_logs**
Auditoria geral do sistema.

```sql
audit_logs (
  audit_id,
  hotel_id, actor_user_id,
  entity_name, entity_id,
  action,         -- INSERT/UPDATE/DELETE
  changes_json,
  created_at
)
```

---

## üîó Diagrama de Relacionamentos

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   hotels    ‚îÇ
‚îÇ  (PK: id)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ              ‚îÇ                ‚îÇ              ‚îÇ                ‚îÇ         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   users     ‚îÇ ‚îÇ   guests   ‚îÇ ‚îÇ  room_types ‚îÇ ‚îÇ    rooms     ‚îÇ ‚îÇ bookings‚îÇ
‚îÇ FK: hotel_id‚îÇ ‚îÇ FK:hotel_id‚îÇ ‚îÇFK:hotel_id  ‚îÇ ‚îÇFK:hotel_id   ‚îÇ ‚îÇFK:hotel ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ             ‚îÇ ‚îÇFK:room_type_id‚îÇ ‚îÇ         ‚îÇ
       ‚îÇ               ‚îÇ        ‚îÇ             ‚îÇ ‚îÇ             ‚îÇ ‚îÇ         ‚îÇ
       ‚îÇ               ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò ‚îÇ         ‚îÇ
       ‚îÇ               ‚îÇ                ‚îÇ                  ‚îÇ     ‚îÇ         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ                  ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ user_roles ‚îÇ ‚îÇ  guest_pii  ‚îÇ        ‚îÇ                  ‚îÇ          ‚îÇ
‚îÇ (Composite)‚îÇ ‚îÇFK:guest_id   ‚îÇ        ‚îÇ                  ‚îÇ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ                  ‚îÇ          ‚îÇ
                                       ‚îÇ                  ‚îÇ          ‚îÇ
                                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
                                ‚îÇrate_plans   ‚îÇ   ‚îÇbooking_rooms ‚îÇ   ‚îÇ
                                ‚îÇFK:hotel_id  ‚îÇ   ‚îÇFK:booking_id ‚îÇ   ‚îÇ
                                ‚îÇFK:room_type ‚îÇ   ‚îÇFK:room_id   ‚îÇ   ‚îÇ
                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
                                      ‚îÇ                   ‚îÇ          ‚îÇ
                                      ‚îÇ                   ‚îÇ          ‚îÇ
                                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                ‚îÇrate_plan_    ‚îÇ  ‚îÇbooking_room_  ‚îÇ
                                ‚îÇ  prices      ‚îÇ  ‚îÇ  nights       ‚îÇ
                                ‚îÇFK:rate_plan  ‚îÇ  ‚îÇFK:booking_room‚îÇ
                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã Fluxos Principais

### **1. Fluxo de Reserva**

```
1. POST /api/bookings
   ‚îî‚îÄ Cria: booking
      ‚îú‚îÄ booking_guests (associa h√≥spedes)
      ‚îú‚îÄ booking_rooms (associa quartos)
      ‚îî‚îÄ booking_room_nights (quebra por noite)

2. GET /api/bookings/{id}
   ‚îî‚îÄ Retorna: booking + guests + rooms + nights

3. PUT /api/bookings/{id}
   ‚îî‚îÄ Atualiza: booking
      ‚îî‚îÄ Cria: booking_status_history (auditoria)
```

### **2. Fluxo de Faturamento**

```
1. POST /api/invoices/{bookingId}
   ‚îî‚îÄ Gera: invoice + invoice_items
      ‚îî‚îÄ Consome: erp_integration_logs

2. Webhook ERP ‚Üí Invoice
   ‚îî‚îÄ Atualiza: invoice (status, nfse_number, protocol)
```

### **3. Fluxo de Notifica√ß√µes (RabbitMQ)**

```
1. BookingCreated Event
   ‚îî‚îÄ INSERT: integration_event_outbox
   ‚îî‚îÄ Worker consome ‚Üí notification_logs
   ‚îî‚îÄ Envia: e-mail de confirma√ß√£o

2. InvoiceCreated Event
   ‚îî‚îÄ INSERT: integration_event_outbox
   ‚îî‚îÄ Worker consome ‚Üí notification_logs
   ‚îî‚îÄ Envia: e-mail com NFSe
```

---

## üîê Seguran√ßa

### **Criptografia de PII**

Os dados pessoais dos h√≥spedes s√£o criptografados usando **AES-GCM**:

- `document_cipher`: Dados criptografados
- `document_nonce`: Nonce √∫nico por mensagem
- `document_tag`: Tag de autentica√ß√£o
- `document_key_version`: Vers√£o da chave

**Fluxo:**
1. Hash SHA256 do valor original para busca
2. Criptografia AES-GCM com chave derivada via Argon2id
3. Armazenamento seguro no banco

### **Hashing para Busca**

Campos sens√≠veis s√£o indexados via hash SHA256:
- `email_sha256`
- `phone_sha256`
- `document_sha256`

Isso permite buscar sem descriptografar.

---

## üóÇÔ∏è √çndices Estrat√©gicos

### **Performance**

```sql
-- Consultas de disponibilidade
CREATE INDEX ix_rooms_hotel_type_status ON rooms(hotel_id, room_type_id, status);
CREATE INDEX ix_bookings_hotel_dates ON bookings(hotel_id, check_in_date, check_out_date, status);

-- Busca de PII (hashes)
CREATE INDEX ix_guest_pii_email_sha256 ON guest_pii(email_sha256);
CREATE INDEX ix_guest_pii_phone_sha256 ON guest_pii(phone_sha256);
CREATE INDEX ix_guest_pii_document_sha256 ON guest_pii(document_sha256);

-- Auditoria
CREATE INDEX ix_audit_hotel ON audit_logs(hotel_id, created_at);
CREATE INDEX ix_audit_entity ON audit_logs(entity_name, entity_id, created_at);

-- Eventos
CREATE INDEX ix_outbox_status ON integration_event_outbox(status, created_at);
CREATE INDEX ix_inbox_event_id ON integration_event_inbox(event_id_ext) UNIQUE;
```

---

## üìä M√©tricas e KPIs

O banco suporta c√°lculos de:

- **Taxa de Ocupa√ß√£o**: `rooms` √ó `bookings` com status CONFIRMED
- **Receita**: Soma de `booking_payments` com status PAID
- **ADR (Average Daily Rate)**: `booking_room_nights.price_amount`
- **Check-ins/Check-outs**: Status do `booking`
- **Notas Fiscais Emitidas**: `invoices` com status ISSUED

---

## üöÄ Pr√≥ximos Passos

1. **Criar Migration**: 
   ```bash
   dotnet ef migrations add InitialSchema
   ```

2. **Aplicar ao Banco**:
   ```bash
   dotnet ef database update
   ```

3. **Seed de Dados**:
   - Roles (Admin, User, Gestor)
   - Amenities padr√£o
   - Templates de notifica√ß√£o

4. **Configurar RabbitMQ** para eventos

5. **Integrar Redis** para cache de disponibilidade

---

## üìù Conven√ß√µes

- **IDs**: `CHAR(36)` (GUIDs formatados)
- **Datas**: `DATETIME(6)` com precis√£o de microsegundos
- **Decimais**: `DECIMAL(12,2)` para valores monet√°rios
- **Booleanos**: `TINYINT(1)` (0/1)
- **M√∫ltiplas Keys**: Usar `[Key]` annotation em ambas propriedades
- **Soft Delete**: Campo `status` em vez de DELETE f√≠sico
- **Timestamps**: `created_at`, `updated_at` autom√°ticos

---

**Documento gerado automaticamente com base no schema SQL fornecido.**

